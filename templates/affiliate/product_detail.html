{% extends "layout.html" %}
{% block content %}
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card shadow-sm">
      <img src="{{ static_url(p.image_path) }}" class="w-100 rounded-top">
      <div class="card-body">
        <h5 class="mb-1">{{ p.name }}</h5>
        <div class="small text-muted mb-2">{{ p.category_name or '—' }}</div>

        <div class="d-flex flex-wrap gap-2 mb-2">
          <span class="badge text-bg-light">السعر: {{ p.price|int }} دج</span>
          <span class="badge text-bg-light">عمولتك: {{ p.commission|int }} دج</span>
          <span class="badge text-bg-light">سعر التوصيل: {{ p.delivery_price|int }} دج</span>
          <span class="badge text-bg-light">التوصيل: {{ 'لمنزل' if p.delivery_mode=='home' else 'للمكتب' }}</span>
        </div>

        <div class="mb-2">
          <label class="form-label small">الوصف</label>
          <div class="copy-box">
            <pre class="m-0">{{ p.description or '—' }}</pre>
            <button class="btn btn-outline-dark btn-sm copy-btn" data-copy="{{ p.description or '' }}"><i class="fa-regular fa-copy"></i></button>
          </div>
        </div>

        {% if p.notes %}
        <div class="alert alert-warning small">
          <i class="fa-solid fa-circle-info me-1"></i> ملاحظات الأدمن: {{ p.notes }}
        </div>
        {% endif %}

        <div class="d-flex gap-2">
          <a class="btn btn-outline-dark" href="{{ dl_url(p.image_path) }}"><i class="fa-solid fa-download me-1"></i> تنزيل الصورة</a>
          <a class="btn btn-brand" href="{{ url_for('affiliate_order', pid=p.id) }}"><i class="fa-solid fa-cart-plus me-1"></i> إنشاء طلبية</a>
        </div>
      </div>
    </div>

    {% if images %}
    <div class="card mt-3">
      <div class="card-header bg-white"><i class="fa-regular fa-images me-1"></i> الصور الإضافية</div>
      <div class="card-body">
        <div class="row g-2">
          {% for im in images %}
            <div class="col-4">
              <a href="{{ static_url(im.image_path) }}" target="_blank">
                <img src="{{ static_url(im.image_path) }}" class="w-100 rounded">
              </a>
              <a class="btn btn-outline-dark btn-sm w-100 mt-1" href="{{ dl_url(im.image_path) }}"><i class="fa-solid fa-download"></i></a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <div class="col-12 col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><i class="fa-solid fa-circle-plus me-1"></i> إنشاء طلبية</div>
      <div class="card-body">
        <form method="post" action="{{ url_for('affiliate_order', pid=p.id) }}" class="row g-2">
          <div class="col-12">
            <label class="form-label">اسم الزبون</label>
            <input class="form-control" name="customer_name" required>
          </div>
          <div class="col-12">
            <label class="form-label">هاتف الزبون</label>
            <input class="form-control" name="customer_phone" required>
          </div>
          <div class="col-12">
            <label class="form-label">العنوان</label>
            <textarea class="form-control" name="customer_address" rows="2" required></textarea>
          </div>
          <div class="col-12">
            <button class="btn btn-brand w-100"><i class="fa-solid fa-paper-plane me-1"></i> تأكيد الطلبية</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
